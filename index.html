<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova Strike: Neon Shadows</title>
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-yellow: #fff200;
            --bg-dark: #0a0a12;
        }

        body {
            margin: 0;
            background: var(--bg-dark);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
        }

        canvas { display: block; background: #000; }

        .ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: rgba(10, 10, 18, 0.85);
            transition: opacity 0.3s;
        }

        .hidden { display: none !important; }

        h1 {
            font-size: 3rem;
            text-transform: uppercase;
            letter-spacing: 5px;
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
            margin-bottom: 2rem;
        }

        .menu-btn {
            background: transparent;
            border: 1px solid var(--neon-pink);
            color: var(--neon-pink);
            padding: 10px 30px;
            margin: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            width: 200px;
            transition: all 0.2s;
        }

        .menu-btn:hover {
            background: var(--neon-pink);
            color: white;
            box-shadow: 0 0 15px var(--neon-pink);
        }

        .stats-bar {
            position: absolute;
            top: 10px; left: 10px; right: 10px;
            display: flex; justify-content: space-between;
            pointer-events: none;
            color: var(--neon-blue);
            font-weight: bold;
        }

        .hangar-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .upgrade-card {
            border: 1px solid var(--neon-blue);
            padding: 15px;
            text-align: center;
        }

        #leaderboard-list {
            list-style: none;
            padding: 0;
            width: 250px;
        }

        #leaderboard-list li {
            display: flex;
            justify-content: space-between;
            padding: 5px;
            border-bottom: 1px solid #333;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <div id="hud" class="stats-bar hidden">
        <div id="hud-score">Score: 0</div>
        <div id="hud-credits">Credits: 0</div>
    </div>

    <div id="main-menu" class="ui-layer">
        <h1>Nova Strike</h1>
        <button class="menu-btn" onclick="startGame()">LAUNCH</button>
        <button class="menu-btn" onclick="showUI('hangar')">HANGAR</button>
        <button class="menu-btn" onclick="showUI('leaderboard')">RECORDS</button>
    </div>

    <div id="hangar" class="ui-layer hidden">
        <h1>Hangar</h1>
        <div id="hangar-credits" style="color: var(--neon-yellow); margin-bottom: 10px;">Credits: 0</div>
        <div class="hangar-grid">
            <div class="upgrade-card">
                <div>Engine (Speed)</div>
                <button class="menu-btn" onclick="buyUpgrade('moveSpeed')">LVL <span id="lvl-speed">1</span>: <span id="cost-speed">50</span>c</button>
            </div>
            <div class="upgrade-card">
                <div>Weapon (Fire Rate)</div>
                <button class="menu-btn" onclick="buyUpgrade('fireRate')">LVL <span id="lvl-fire">1</span>: <span id="cost-fire">75</span>c</button>
            </div>
        </div>
        <button class="menu-btn" onclick="showUI('main-menu')">BACK</button>
    </div>

    <div id="leaderboard" class="ui-layer hidden">
        <h1>Top Pilots</h1>
        <ul id="leaderboard-list"></ul>
        <button class="menu-btn" onclick="showUI('main-menu')">BACK</button>
    </div>
</div>

<script>
/** 1. DATA LOGIC & PERSISTENCE **/
let gameState = {
    credits: 0,
    highScores: [],
    upgrades: {
        moveSpeed: 1,
        fireRate: 1
    }
};

function saveGame() {
    localStorage.setItem('novaStrikeSave', JSON.stringify(gameState));
}

function loadGame() {
    const saved = localStorage.getItem('novaStrikeSave');
    if (saved) {
        gameState = JSON.parse(saved);
        updateHangarUI();
    }
}

/** 2. GAME ENGINE VARIABLES **/
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let isPlaying = false;
let score = 0;
let sessionCredits = 0;

const player = {
    x: 400, y: 500, w: 30, h: 30,
    bullets: [],
    lastShot: 0
};

let enemies = [];
let particles = [];
let keys = {};

/** 3. GAMEPLAY MECHANICS **/
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

function startGame() {
    isPlaying = true;
    score = 0;
    sessionCredits = 0;
    enemies = [];
    particles = [];
    player.x = 400; player.y = 500;
    showUI('hud');
    requestAnimationFrame(gameLoop);
}

function update() {
    if (!isPlaying) return;

    // Movement logic (Scaled by upgrades)
    const speed = 4 + (gameState.upgrades.moveSpeed * 0.8);
    if (keys['ArrowLeft'] || keys['KeyA']) player.x -= speed;
    if (keys['ArrowRight'] || keys['KeyD']) player.x += speed;
    if (keys['ArrowUp'] || keys['KeyW']) player.y -= speed;
    if (keys['ArrowDown'] || keys['KeyS']) player.y += speed;

    // Shooting logic (Fire rate decreases delay)
    const fireDelay = 400 - (gameState.upgrades.fireRate * 40);
    if (keys['Space'] && Date.now() - player.lastShot > Math.max(100, fireDelay)) {
        player.bullets.push({x: player.x + 12, y: player.y, v: 7});
        player.lastShot = Date.now();
    }

    // Bullet movement
    player.bullets.forEach((b, i) => {
        b.y -= b.v;
        if (b.y < 0) player.bullets.splice(i, 1);
    });

    // Enemy Spawning
    if (Math.random() < 0.02 + (score/10000)) {
        enemies.push({ x: Math.random() * (canvas.width-30), y: -30, w: 30, h: 30, hp: 1 });
    }

    // Enemy movement & Collision
    enemies.forEach((en, ei) => {
        en.y += 2 + (score/5000);
        
        // Bullet hit
        player.bullets.forEach((b, bi) => {
            if (b.x < en.x + en.w && b.x + 5 > en.x && b.y < en.y + en.h && b.y + 10 > en.y) {
                enemies.splice(ei, 1);
                player.bullets.splice(bi, 1);
                score += 100;
                spawnParticles(en.x, en.y, '#fff200', 5); // Drops
                sessionCredits += 1;
            }
        });

        // Player collision
        if (player.x < en.x + en.w && player.x + player.w > en.x && player.y < en.y + en.h && player.y + player.h > en.y) {
            gameOver();
        }

        if (en.y > canvas.height) enemies.splice(ei, 1);
    });

    // Update particles
    particles.forEach((p, i) => {
        p.y += p.vy; p.x += p.vx;
        p.life--;
        if (p.life <= 0) particles.splice(i, 1);
    });

    document.getElementById('hud-score').innerText = `Score: ${score}`;
    document.getElementById('hud-credits').innerText = `Credits: ${sessionCredits}`;
}

function draw() {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Draw Player (Neon Triangle)
    ctx.strokeStyle = '#00f3ff';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(player.x + 15, player.y);
    ctx.lineTo(player.x, player.y + 30);
    ctx.lineTo(player.x + 30, player.y + 30);
    ctx.closePath();
    ctx.stroke();

    // Draw Bullets
    ctx.fillStyle = '#ff00ff';
    player.bullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 10));

    // Draw Enemies
    ctx.strokeStyle = '#ff0055';
    enemies.forEach(en => {
        ctx.strokeRect(en.x, en.y, en.w, en.h);
    });

    // Draw Credits/Particles
    particles.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, 3, 3);
    });
}

function gameLoop() {
    if (!isPlaying) return;
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

/** 4. UI & STORE LOGIC **/
function showUI(id) {
    document.querySelectorAll('.ui-layer, .stats-bar').forEach(el => el.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    if (id === 'leaderboard') renderLeaderboard();
    if (id === 'hangar') updateHangarUI();
}

function buyUpgrade(type) {
    const cost = gameState.upgrades[type] * 50;
    if (gameState.credits >= cost) {
        gameState.credits -= cost;
        gameState.upgrades[type]++;
        saveGame();
        updateHangarUI();
    } else {
        alert("Not enough credits!");
    }
}

function updateHangarUI() {
    document.getElementById('hangar-credits').innerText = `Credits: ${gameState.credits}`;
    document.getElementById('lvl-speed').innerText = gameState.upgrades.moveSpeed;
    document.getElementById('cost-speed').innerText = gameState.upgrades.moveSpeed * 50;
    document.getElementById('lvl-fire').innerText = gameState.upgrades.fireRate;
    document.getElementById('cost-fire').innerText = gameState.upgrades.fireRate * 75;
}

function gameOver() {
    isPlaying = false;
    gameState.credits += sessionCredits;
    
    // Local Leaderboard logic
    gameState.highScores.push(score);
    gameState.highScores.sort((a, b) => b - a);
    gameState.highScores = gameState.highScores.slice(0, 5);
    
    saveGame();
    alert(`GAME OVER\nScore: ${score}\nCredits Collected: ${sessionCredits}`);
    showUI('main-menu');
}

function renderLeaderboard() {
    const list = document.getElementById('leaderboard-list');
    list.innerHTML = gameState.highScores.map((s, i) => `<li><span>#${i+1}</span> <span>${s}</span></li>`).join('');
}

function spawnParticles(x, y, color, count) {
    for(let i=0; i<count; i++) {
        particles.push({
            x, y, 
            vx: (Math.random()-0.5)*4, 
            vy: (Math.random()-0.5)*4, 
            life: 30, 
            color
        });
    }
}

// Init
loadGame();
</script>
</body>
</html>